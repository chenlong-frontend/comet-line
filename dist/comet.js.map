{"version":3,"file":"comet.js","sources":["../index.js"],"sourcesContent":["/*\r\n * @Description: comet-line\r\n * @Author: chenlong\r\n * @Date: 2021-03-22 17:03:35\r\n * @LastEditTime: 2021-04-26 10:04:42\r\n * @LastEditors: chenlong\r\n */\r\n\r\nfunction Point(x, y) {\r\n  this.x = x\r\n  this.y = y\r\n}\r\n\r\nfunction square(path) {\r\n  if (!Array.isArray(path)) {\r\n    throw Error('path must be array')\r\n  }\r\n  let pathArr = []\r\n  let pre = null\r\n  for (let it of path) {\r\n    if (!pre) {\r\n      pre = it\r\n      continue\r\n    }\r\n    let width = it[0] - pre[0]\r\n    let height = it[1] - pre[1]\r\n    let min = Math.min(width === 0 ? Infinity : width, Math.abs(height === 0 ? Infinity : height))\r\n    if (min === Infinity) continue\r\n    const wstep = width / min\r\n    const hstep = height / min\r\n    for (let i = 0;i < min;i++) {\r\n      pathArr.push(new Point(pre[0] + wstep * i, pre[1] + hstep * i))\r\n    }\r\n    pre = it\r\n  }\r\n  pathArr.push(new Point(pre[0], pre[1]))\r\n  return pathArr\r\n}\r\n\r\nPoint.prototype.toString = function () {\r\n  return `(${this.x}, ${this.y})`\r\n}\r\n\r\nfunction Comet(canvas, option) {\r\n  if (!option || !canvas) return\r\n  const { path, pathColor, cometColor, pathVisible } = option\r\n  if (!Array.isArray(path)) {\r\n    throw Error('path must be array')\r\n  }\r\n  let stopFlag = false\r\n  let time = 0\r\n  let comets = []\r\n  let pathArr = [].concat(path)\r\n  const ctx = canvas.getContext('2d')\r\n\r\n  function draw() {\r\n    time++\r\n    const currentPath = pathArr[time]\r\n    ctx.clearRect(0, 0, 5000, 5000)\r\n    if (pathVisible) {\r\n      ctx.lineWidth = 1\r\n      ctx.strokeStyle = pathColor || '#444444'\r\n      ctx.beginPath()\r\n  \r\n      for (let i = 0; i < pathArr.length - 1; i++) {\r\n        ctx.moveTo(pathArr[i].x, pathArr[i].y)\r\n        ctx.lineTo(pathArr[i + 1].x, pathArr[i + 1].y)\r\n      }\r\n      ctx.stroke()\r\n    }\r\n\r\n    if (comets.length > 30) {\r\n      comets.shift()\r\n    }\r\n    for (let i = 0; i < comets.length; i++) {\r\n      comets[i].a = (i + 1) * 0.03\r\n      comets[i].s = (i + 1) * 0.025\r\n    }\r\n    const b = { a: 1, s: 1, x: currentPath.x, y: currentPath.y }\r\n    comets.push(b);\r\n    for (let i = 0; i< comets.length; i++) {\r\n      const b = comets[i];\r\n      ctx.save();\r\n      ctx.beginPath();\r\n      ctx.globalAlpha = b.a; \r\n      ctx.globalCompositeOperation = 'lighter';\r\n      ctx.fillStyle = cometColor || '#66FF00';\r\n      ctx.arc(b.x, b.y, b.s * 1, 0, 2 * Math.PI, false);\r\n      ctx.fill();\r\n      ctx.restore();\r\n    }\r\n    if (time === pathArr.length - 1) {\r\n      time = 0;\r\n    }\r\n    !stopFlag && requestAnimationFrame(draw);\r\n  }\r\n  function stop () {\r\n    stopFlag = true\r\n  }\r\n  function play () {\r\n    stopFlag = false\r\n    draw()\r\n  }\r\n  return {\r\n    play,\r\n    stop\r\n  }\r\n}\r\nComet.Point = Point\r\nComet.square = square\r\n\r\nexport default Comet\r\n"],"names":["Point","x","y","Comet","canvas","option","path","pathColor","cometColor","pathVisible","Array","isArray","Error","stopFlag","time","comets","pathArr","concat","ctx","getContext","draw","currentPath","clearRect","lineWidth","strokeStyle","beginPath","i","length","moveTo","lineTo","stroke","shift","a","s","b","push","save","globalAlpha","globalCompositeOperation","fillStyle","arc","Math","PI","fill","restore","requestAnimationFrame","play","stop","prototype","toString","this","square","pre","it","width","height","min","Infinity","abs","wstep","hstep"],"mappings":"sOAQA,SAASA,EAAMC,EAAGC,QACXD,EAAIA,OACJC,EAAIA,EAiCX,SAASC,EAAMC,EAAQC,OAChBA,IAAWD,EAAQ,aAClBE,KAAEA,EAAFC,UAAQA,EAARC,WAAmBA,EAAnBC,YAA+BA,GAAgBJ,MAChDK,MAAMC,QAAQL,SACXM,MAAM,0BAEVC,GAAW,EACXC,EAAO,EACPC,EAAS,GACTC,EAAU,GAAGC,OAAOX,SAClBY,EAAMd,EAAOe,WAAW,eAErBC,IACPN,UACMO,EAAcL,EAAQF,MAC5BI,EAAII,UAAU,EAAG,EAAG,IAAM,KACtBb,EAAa,CACfS,EAAIK,UAAY,EAChBL,EAAIM,YAAcjB,GAAa,UAC/BW,EAAIO,gBAEC,IAAIC,EAAI,EAAGA,EAAIV,EAAQW,OAAS,EAAGD,IACtCR,EAAIU,OAAOZ,EAAQU,GAAGzB,EAAGe,EAAQU,GAAGxB,GACpCgB,EAAIW,OAAOb,EAAQU,EAAI,GAAGzB,EAAGe,EAAQU,EAAI,GAAGxB,GAE9CgB,EAAIY,SAGFf,EAAOY,OAAS,IAClBZ,EAAOgB,YAEJ,IAAIL,EAAI,EAAGA,EAAIX,EAAOY,OAAQD,IACjCX,EAAOW,GAAGM,EAAc,KAATN,EAAI,GACnBX,EAAOW,GAAGO,EAAc,MAATP,EAAI,SAEfQ,EAAI,CAAEF,EAAG,EAAGC,EAAG,EAAGhC,EAAGoB,EAAYpB,EAAGC,EAAGmB,EAAYnB,GACzDa,EAAOoB,KAAKD,OACP,IAAIR,EAAI,EAAGA,EAAGX,EAAOY,OAAQD,IAAK,OAC/BQ,EAAInB,EAAOW,GACjBR,EAAIkB,OACJlB,EAAIO,YACJP,EAAImB,YAAcH,EAAEF,EACpBd,EAAIoB,yBAA2B,UAC/BpB,EAAIqB,UAAY/B,GAAc,UAC9BU,EAAIsB,IAAIN,EAAEjC,EAAGiC,EAAEhC,EAAS,EAANgC,EAAED,EAAO,EAAG,EAAIQ,KAAKC,IAAI,GAC3CxB,EAAIyB,OACJzB,EAAI0B,UAEF9B,IAASE,EAAQW,OAAS,IAC5Bb,EAAO,IAERD,GAAYgC,sBAAsBzB,SAS9B,CACL0B,gBAJAjC,GAAW,EACXO,KAIA2B,gBARAlC,GAAW,WA1Dfb,EAAMgD,UAAUC,SAAW,iBACjB,IAAGC,KAAKjD,MAAMiD,KAAKhD,MAoE7BC,EAAMH,MAAQA,EACdG,EAAMgD,OAhGN,SAAgB7C,OACTI,MAAMC,QAAQL,SACXM,MAAM,0BAEVI,EAAU,GACVoC,EAAM,SACL,IAAIC,KAAM/C,EAAM,KACd8C,EAAK,CACRA,EAAMC,eAGJC,EAAQD,EAAG,GAAKD,EAAI,GACpBG,EAASF,EAAG,GAAKD,EAAI,GACrBI,EAAMf,KAAKe,IAAc,IAAVF,EAAcG,EAAAA,EAAWH,EAAOb,KAAKiB,IAAe,IAAXH,EAAeE,EAAAA,EAAWF,OAClFC,IAAQC,EAAAA,EAAU,eAChBE,EAAQL,EAAQE,EAChBI,EAAQL,EAASC,MAClB,IAAI9B,EAAI,EAAEA,EAAI8B,EAAI9B,IACrBV,EAAQmB,KAAK,IAAInC,EAAMoD,EAAI,GAAKO,EAAQjC,EAAG0B,EAAI,GAAKQ,EAAQlC,IAE9D0B,EAAMC,SAERrC,EAAQmB,KAAK,IAAInC,EAAMoD,EAAI,GAAIA,EAAI,KAC5BpC"}